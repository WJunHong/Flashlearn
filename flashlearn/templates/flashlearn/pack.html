{% extends "flashlearn/base.html" %} 
{% load static %} 
{% block css %}
<link href="{% static 'flashlearn/styles_pack.css' %}" rel="stylesheet" />
{% endblock %} 
{% block dependencies %}
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js" charset="utf-8" crossorigin="anonymous" ></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
{% endblock %}
{% block body %}

<div class="pack-container">
<div class="card shadow mt-2" style="width: 90%; margin: auto;">
    <div class="card-body">
        <h5 class="card-title mb-4" id="pack-name"><b>{{pack.name}}</b><span class="badge badge-success ml-2">#{{pack.packId}}</span></h5>
       
        <div id="middle-row" class=" mb-4 "><span id="like-count">{{pack.like_count}}</span> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="red" class="bi bi-fire" viewBox="0 0 16 16">
            <path d="M8 16c3.314 0 6-2 6-5.5 0-1.5-.5-4-2.5-6 .25 1.5-1.25 2-1.25 2C11 4 9 .5 6 0c.357 2 .5 4-2 6-1.25 1-2 2.729-2 4.5C2 14 4.686 16 8 16Zm0-1c-1.657 0-3-1-3-2.75 0-.75.25-2 1.25-3C6.125 10 7 10.5 7 10.5c-.375-1.25.5-3.25 2-3.5-.179 1-.25 2 1 3 .625.5 1 1.364 1 2.25C11 14 9.657 15 8 15Z"/>
          {% if pack.category %}
          </svg><span class="badge badge-pill badge-secondary ml-3">pack.category</span>
         {% endif %}
        </div>
                {% if user.is_authenticated %}
                <form method="post" action="" class="mb-3 like-actions">
                  <button class="like-btn {% if liked %} like {% else %} no-like {% endif %}"><svg xmlns="http://www.w3.org/2000/svg" width="16"  height="16" fill="white" class="bi bi-hand-thumbs-up-fill" viewBox="0 0 16 16">
                      <path d="M6.956 1.745C7.021.81 7.908.087 8.864.325l.261.066c.463.116.874.456 1.012.965.22.816.533 2.511.062 4.51a9.84 9.84 0 0 1 .443-.051c.713-.065 1.669-.072 2.516.21.518.173.994.681 1.2 1.273.184.532.16 1.162-.234 1.733.058.119.103.242.138.363.077.27.113.567.113.856 0 .289-.036.586-.113.856-.039.135-.09.273-.16.404.169.387.107.819-.003 1.148a3.163 3.163 0 0 1-.488.901c.054.152.076.312.076.465 0 .305-.089.625-.253.912C13.1 15.522 12.437 16 11.5 16H8c-.605 0-1.07-.081-1.466-.218a4.82 4.82 0 0 1-.97-.484l-.048-.03c-.504-.307-.999-.609-2.068-.722C2.682 14.464 2 13.846 2 13V9c0-.85.685-1.432 1.357-1.615.849-.232 1.574-.787 2.132-1.41.56-.627.914-1.28 1.039-1.639.199-.575.356-1.539.428-2.59z"/>
                    </svg></button>
                  <button class="dislike-btn {% if disliked %} dislike {% else %} no-dislike {% endif %}" ><svg xmlns="http://www.w3.org/2000/svg" width="16"  height="16" fill="white" class="bi bi-hand-thumbs-down-fill" viewBox="0 0 16 16">
                      <path d="M6.956 14.534c.065.936.952 1.659 1.908 1.42l.261-.065a1.378 1.378 0 0 0 1.012-.965c.22-.816.533-2.512.062-4.51.136.02.285.037.443.051.713.065 1.669.071 2.516-.211.518-.173.994-.68 1.2-1.272a1.896 1.896 0 0 0-.234-1.734c.058-.118.103-.242.138-.362.077-.27.113-.568.113-.856 0-.29-.036-.586-.113-.857a2.094 2.094 0 0 0-.16-.403c.169-.387.107-.82-.003-1.149a3.162 3.162 0 0 0-.488-.9c.054-.153.076-.313.076-.465a1.86 1.86 0 0 0-.253-.912C13.1.757 12.437.28 11.5.28H8c-.605 0-1.07.08-1.466.217a4.823 4.823 0 0 0-.97.485l-.048.029c-.504.308-.999.61-2.068.723C2.682 1.815 2 2.434 2 3.279v4c0 .851.685 1.433 1.357 1.616.849.232 1.574.787 2.132 1.41.56.626.914 1.28 1.039 1.638.199.575.356 1.54.428 2.591z"/>
                    </svg></button>
                </form>
                {% endif %}
    <div id="bottom-segment">
    <div id="left-side">
      <form action="" method="post" class="mt-3">
        {% if user.is_authenticated %}
       
          {% if favourite %}
          <button class="btn btn-outline-warning mb-3" id="fav-btn">
          Remove from favourites <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="yellow" class="bi bi-star-fill" viewBox="0 0 16 18">
          <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
        </svg>
      </button>
          {% else %}
          <button class="btn btn-outline-secondary mb-3" id="fav-btn">
          Add to favourites <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="grey" class="bi bi-star-fill" viewBox="0 0 16 18">
            <path d="M3.612 15.443c-.386.198-.824-.149-.746-.592l.83-4.73L.173 6.765c-.329-.314-.158-.888.283-.95l4.898-.696L7.538.792c.197-.39.73-.39.927 0l2.184 4.327 4.898.696c.441.062.612.636.282.95l-3.522 3.356.83 4.73c.078.443-.36.79-.746.592L8 13.187l-4.389 2.256z"/>
          </svg>
        </button>
          {% endif %}
      
      
      </form>
      {% endif %}
       <p class="card-text"><b>Created by:</b> {{pack.creator.username}}</p>
       {% if pack.description %}
       <p class="card-text"><b>Description:</b> <br><i class="descrip">{{pack.description}}</i></p>
       {% endif %}
       <p class="card-text"><b>Card count:</b> {{ pack.cards }}</p>
       <p class="card-text"><b>Average difficulty:</b> {{ pack.avg_difficulty }}</p>
       <p class="card-text"><b>Privacy:
          {% if pack.privacy == "A" %}
        </b>All</p>
          {% elif pack.privacy == "F" %}
        </b>Friends</p>
          {% elif pack.privacy == "P" %}
        </b>Private</p>
        {% endif %}

    </div>
        <div id="right-side">
            <p class="card-text"><b>Statistics:</b></p>
            <p>Global plays: {{ play_count }}</p>
            <!-- Use plotly -->
            <div id="scoreBoxPlot">
              {{plot|safe}}
            </div> 
            {% if user.is_authenticated %}
            <p>Your best score: {{best_score}}</p>
            <p>Your average score: {{avg_score}}</p>
            {% endif %}
        </div>
    </div>
        <div class="mt-5 mb-3">            
            <!-- Create modal for editing info, update page on submit -->
            {% if user.is_authenticated and is_creator %}
            <button id="edit-btn" data-toggle="modal" data-target="#editModal">Edit <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" class="bi bi-pen-fill" viewBox="0 0 16 16">
                <path d="m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001z"/>
              </svg></button>
            {% endif %}
            <!-- Generate new content within card below this -->
            <button {% if not can_play and not is_creator %} disabled {% endif %} id="start-btn">Start new game <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="white" class="bi bi-caret-down-fill flipme" viewBox="0 0 16 16">
                <path d="M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"/>
              </svg></button>
        </div>
        <div class="mt-4 d-none" id="game-details">
            <div class="form-group">
                <label for="select-order">Order:</label>
                <select class="custom-select form-control shadow-none" id="select-order" aria-describedby="order-help">
                    <option value="random" selected>Random</option>
                    <option value="difficulty">Difficulty</option>
                  </select>
                <small id="order-help" class="form-text text-muted">How should cards be shown?</small>
              </div>
            <div class="form-group">
                <label for="select-handicap">Difficulty handicap:</label>
                <select class="custom-select form-control shadow-none" id="select-handicap" aria-describedby="handicap-help">
                    <option value="n" selected>No</option>
                    <option value="y">Yes</option>
                  </select>
                <small id="handicap-help" class="form-text text-muted">Medium questions get +5s, hard ones get +10s</small>
              </div>
            <div class="form-group">
                <label for="select-duration">Duration:</label>
                <select class="custom-select form-control shadow-none" id="select-duration" aria-describedby="duration-help">
                    <option value="10" selected>10s</option>
                    <option value="5">5s</option>
                    <option value="15" >15s</option>
                    <option value="20">20s</option>
                    <option value="25" >25s</option>
                    <option value="30">30s</option>
                  </select>
                <small id="duration-help" class="form-text text-muted">How long should each card be shown for?</small>
              </div>
            <div class="form-group">
                <label for="select-hints">Enable hints:</label>
                <select class="custom-select form-control shadow-none" id="select-hints" aria-describedby="hints-help">
                    <option value="n" selected>No</option>
                    <option value="y" >Yes</option>
                  </select>
                <small id="hints-help" class="form-text text-muted">Would you like help recalling?</small>
              </div>
            
            <input class="btn btn-success"type="submit" value="Go!" id="start-game" data-toggle="modal" data-target="#gameModal">
            </div>
      </div>

</div>



</div>
<script>
    $(function () {
  $('[data-toggle="tooltip"]').tooltip()
})
</script>
<div class="modal fade" id="gameModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="card-question"></h5>
        <!-- <button type="button"
        class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button> -->
      </div>
      <div class="modal-body">
        <input type="text" class="form-control mb-3" id="card-answer">
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" role="switch" id="show-card-hint">
          <label class="form-check-label" for="show-card-hint">Show available hint</label>
        </div>
        <p id="card-hint" class="d-none"></p>

        <div id="card-image"></div>
        <div class="alert alert-danger d-none" role="alert" id="wrong-answer">
          Your answer is wrong!
        </div>
        <div class="alert alert-success d-none" role="alert" id="correct-answer">
          
        </div>
      </div>
      <div class="modal-footer">
        <div id="timer"></div>
        <button class="btn btn-success d-none" id="submit-game">Submit results!</button>
        <button class="btn btn-primary" id="submit-answer">Answer!</button>
      </div>
    </div>
  </div>
</div>
<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Edit</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <input id="card-count-back" type="text" value="{{pack.cards}}" readonly hidden/>
      <div class="modal-body">
        <form action="" method="post" id="edit-form">
          <div class="form-group">
            <label for="edit-pack-name">Pack name:</label>
            <input type="text" class="form-control shadow-none" id="edit-pack-name" aria-describedby="name-help" autocomplete="off" placeholder="Name" value="{{pack.name}}" name="name" required>
            <small id="name-help" class="form-text text-muted">Give a new name to your pack!</small>
          </div>
          <div class="form-group">
            <label for="edit-cat">Category (optional):</label>
            
          
            <select name="category" id="edit-cat" class="form-control shadow-none"  aria-describedby="cat-help">
              {% if not pack.category %}
              <option value="" selected disabled hidden>Choose here</option>
              {% for cat in categories %}
              <option value="{{ cat.name }}">{{cat.name}}</option>
              {% endfor %}
              {% else %}
              {% for cat in categories %}
              <option value="{{ cat.name }}" {% if pack.category.name == cat.name %} selected {% endif %}>{{cat.name}}</option>
              {% endfor %}
              <option value="">remove</option>
              {% endif %}    
            </select>
            <small id="cat-help" class="form-text text-muted">Remove or choose a new category!</small>
          </div>
          <div class="form-group">
            <label for="edit-descrip">Description (optional):</label>
            <input type="text" class="form-control shadow-none" id="edit-descrip" aria-describedby="descrip-help" autocomplete="off" {% if pack.description %} value="{{pack.description}}" {% else %} value="" {% endif %} placeholder="Add a description!" name="descrip">
            <small id="descrip-help" class="form-text text-muted">Add or remove a description for your pack!</small>
          </div>
          <div class="form-group">
            <label for="edit-privacy">Privacy:</label>
            <select class="custom-select form-control shadow-none" id="edit-privacy" aria-describedby="privacy-help">
              <option value="private" >Self</option>
              <option value="friends" >Friends</option>
              <option value="all" >All</option>
            </select>
            <small id="privacy-help" class="form-text text-muted">Set new privacy for your pack!</small>
          </div>
          <div id="cards-div">
          {% for i, card in cards %}
          <input id="cid{{i}}" value="{{card.id}}" hidden readonly />
          <div class="card mt-2">
            <div class="card-body">
              <div class="form-group">
                <label for="question-{{i}}">Question:</label>
                <input type="text" class="form-control shadow-none" id="question-{{i}}" autocomplete="off" value="{{card.question}}" name="question-{{i}}" required>
              </div>
              <div class="form-group">
                <label for="hint-{{i}}">Hint (optional):</label>
                <input type="text" class="form-control shadow-none" id="hint-{{i}}" autocomplete="off" {% if card.hint %} value="{{card.hint}}" {% else %} value="" {% endif %} name="hint-{{i}}">
              </div>
              <div class="form-group">
                <label for="answer-{{i}}">Answer:</label>
                <input type="text" class="form-control shadow-none" id="answer-{{i}}" autocomplete="off" value="{{card.answer}}" name="answer-{{i}}" required>
              </div>
              <div class="form-group" id="edit-diff-container-{{i}}">
                <label>Difficulty:</label>

                <div class="form-check">
                  <input class="form-check-input" type="radio" name="edit-diff-{{i}}" id="edit-diff-easy-{{i}}"
                  {% if card.difficulty == "E" %}
                  checked
                  {% endif %} value="E"
                  >
                  <label class="form-check-label" for="edit-diff-easy-{{i}}">
                    Easy
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="edit-diff-{{i}}" id="edit-diff-med-{{i}}" 
                  {% if card.difficulty == "M" %}
                  checked
                  {% endif %}  value="M"
                  >
                  <label class="form-check-label" for="edit-diff-med-{{i}}">
                    Medium
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="edit-diff-{{i}}" id="edit-diff-hard-{{i}}" 
                  {% if card.difficulty == "H" %}
                  checked
                  {% endif %}  value="H"
                  >
                  <label class="form-check-label" for="edit-diff-hard-{{i}}">
                    Hard
                  </label>
                </div>
              </div>
              <div class="form-group">
                <label>Original Image: </label><br>
                {% if card.image %}
                <img src="{{card.image.url}}" width="168" height="168" /><br>
                {% else %}
                <p class="text-muted">Card has no image</p>
                {% endif %}
                <label>Change supporting Image:</label>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="edit-img-{{i}}" id="remove-img-{{i}}" value="True">
                  <label class="form-check-label" for="remove-img-{{i}}">
                    Remove image
                  </label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="edit-img-{{i}}" id="new-img-{{i}}" value="False" checked>
                  <label class="form-check-label" for="new-img-{{i}}">
                    Add new image
                  </label>
                </div>
                <input type="file" id="img-{{i}}" accept="image/*" >
              </div>
            </div>
            <div class="card-footer">
              <button class="btn btn-danger shadow-none mt-2" id="remove{{i}}">Remove card -</button>
              <input type="text" id="use{{i}}", value="T" hidden readonly>
                  </div>
                  <div class="d-none cover-cancel" id="cover{{i}}">
                    <button class="btn btn-secondary" id="undo{{i}}">Undo</button>
                  </div>

          </div>
          {% endfor %}
        </div>
          <button class="btn btn-success mt-2" id="add-btn">Add card</button>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger mr-auto" id="pack-delete-btn">Delete Pack</button>
        <button type="button" id="save-edit-btn" class="btn btn-primary">Save changes</button>
      </div>
    </form>
    </div>
  </div>
</div>
{% endblock %}

{% block script %}
<script>
  var packId = "{{ pack.packId }}";
  var cards_for_play = '{{cards_play|safe}}';
</script>
<script src="{% static 'flashlearn/pack.js'%}">

</script>
{% endblock %}